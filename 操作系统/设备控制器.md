为了屏蔽键盘、鼠标、显示器、网卡等等这些设备之间的差异，每个设备都有一个 **设备控制器**（Device Control） 的组件

设备控制器里有芯片，可执行自己的逻辑，也有自己的寄存器，用于与 CPU 进行通信，比如：

1. 通过写入这些寄存器，操作系统可以命令设备发送数据、接收数据、开启或关闭，或者执行某些其他操作
2. 通过读取这些寄存器，操作系统可以了解设备的状态，是否准备好接收一个新的命令等

实际上，控制器有三类寄存器，分别是 **状态寄存器**（Status Register）、**命令寄存器**（Command Register）和 **数据寄存器**（Data Register），它们的作用分别是：

1. **数据寄存器**：CPU 向 I/O 设备写入需要传输的数据，比如要打印的内容
2. **命令寄存器**：CPU 发送一个命令，告诉 I/O 设备，要进行输入/输出操作，于是就会交给 I/O 设备区工作，任务完成后，会把状态寄存器里的状态标记为完成
3. **状态寄存器**：目的是告诉 CPU，现在已经在工作或工作已完成，如果在工作状态，CPU 再发送任何数据或命令过来，都是没有用的，直到前面的工作已经完成，状态寄存器标记为已完成，CPU 才能发送下一个数据或命令

另外，输入输出设备可分为两大类：**块设备**（Block Device）和 **字符设备**（Character Device）

1. **块设备**：把数据存储在固定大小的块中，每个块都有自己的地址。硬盘、USB 是常见的块设备
2. **字符设备**：以字符为单位发送或接收一个字符流，字符设备是 **不可寻址** 的，也没有任何寻道操作，鼠标是常见的字符设备

块设备通常传输的数据量会非常大，于是控制器设立了一个可读写的数据缓冲区

1. CPU 写入数据到控制器的缓冲区时，当缓冲区的数据囤够了一部分，才会发送给设备
2. CPU 从控制器的缓冲区读取数据时，也需要缓冲区囤够了一部分，才拷贝到内存

CPU 如何与设备的控制寄存器和数据缓冲区进行通信？

1. **端口 I/O**：每个控制寄存器被分配一个 I/O 端口，可以通过特殊的汇编指令操作这些寄存器，比如 **in/out** 等指令
2. **内存映射 I/O**：将所有控制寄存器映射到内存空间，这样就可以像读写内存一样读写数据缓冲区
